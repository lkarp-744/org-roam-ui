"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[852],{2852:function(e,l,r){r.r(l),r.d(l,{default:function(){return A}});var t=r(5893),n=r(6645),i=r(8460),o=r(7984),d=r(8029),u=r(7294),c=r(4087),a=r.n(c);function s(e){let l=(0,u.useRef)(e);return l.current=e,l}function h(e){let l=(0,u.useRef)(null),r=s(e);return l.current||(l.current=function(){for(var e=arguments.length,l=Array(e),t=0;t<e;t++)l[t]=arguments[t];return r.current.apply(this,l)}),l.current}function g(e,l,r){let t=(0,u.useRef)(0),n=(0,u.useRef)(0),i=s(e),o=h(e=>{n.current||(n.current=e);let d=e-n.current,u=l>0?d/l:1;u<0&&(u=0),u>1&&(u=1),u<1&&(t.current=a()(o)),r?i.current(r(u)):i.current(u)}),d=(0,u.useCallback)(()=>{t.current&&(a().cancel(t.current),t.current=0),n.current=0},[]),c=h(()=>{d(),t.current=a()(o)});return!function(e){let l=(0,u.useRef)(e);l.current=e,(0,u.useEffect)(()=>()=>{l.current()},[])}(d),[c,d]}var f=r(6377),v=r(2802),p=r.n(v),k=r(5871),m=r(8256),C=r(7173),b=r(2663),y=r.n(b),S=r(2101);let N=e=>{var l;let{linksByNodeId:r,visuals:t,highlightedNodes:n,previouslyHighlightedNodes:i,opacity:o,node:d}=e,u=null!==(l=r[d.id])&&void 0!==l?l:[],c=u.length?u.filter(e=>"parent"===e.type).length:0,a=3+u.length*t.nodeSizeLinks-(S.h.parent?0:c);return 1===t.highlightNodeSize?a:a*(n[d.id]||i[d.id]?1+o*(t.highlightNodeSize-1):1)};function x(e,l){return"rgba("+(e=e.replace("#","")).match(RegExp("(.{"+e.length/3+"})","g")).map(l=>parseInt(e.length%2?l+l:l,16)).concat(isFinite(l)?l:1).join(",")+")"}let I=(e,l,r,t,n)=>n?Math.max(e,t):1*e*(-1*(l.highlightFade*t-1));var F=r(4452);let L=e=>{let{ids:l,excludedIds:r,n:t,linksByNodeId:n}=e,i=[l[0]],o=[],d=[l[0]];return Array.from({length:t},()=>{i.forEach(e=>{var l;(null!==(l=n[e])&&void 0!==l?l:[]).forEach(e=>{let[l,t]=(0,F.J)(e);if(!r.some(e=>[l,t].includes(e))){if(!d.includes(l)){o.push(l);return}d.includes(t)||o.push(t)}})}),i=o,o.forEach(e=>e&&d.push(e)),o=[]}),d};var E=r(8920);let R=(e,l,r)=>Math.min(Math.max(e,l),r),w=e=>{var l,r;let{id:t,linksByNodeId:n,visuals:i,coloring:o,cluster:d}=e,u=null!==(r=null===(l=n[t])||void 0===l?void 0:l.length)&&void 0!==r?r:0;return"degree"===o.method?i.nodeColorScheme[R(u,0,i.nodeColorScheme.length-1)]:i.nodeColorScheme[u&&d[t]%i.nodeColorScheme.length]},M=e=>{var l,r;let{node:t,theme:n,highlightedNodes:i,previouslyHighlightedNodes:o,visuals:d,tagColors:u,highlightColors:c,opacity:a,emacsNodeId:s,linksByNodeId:h,cluster:g,coloring:f}=e,v=i[t.id]||o[t.id];if(d.emacsNodeColor&&t.id===s)return(0,E.p)(d.emacsNodeColor,n);if(u&&(null==t?void 0:t.tags.some(e=>u[e]))){let e=u[null==t?void 0:t.tags.filter(e=>u[e])[0]];return v?c[e][e](d.highlightFade*a):c[e][d.backgroundColor](d.highlightFade*a)}return d.citeNodeColor&&(null==t?void 0:null===(l=t.properties)||void 0===l?void 0:l.ROAM_REFS)&&(null==t?void 0:null===(r=t.properties)||void 0===r?void 0:r.FILELESS)?v?(0,E.p)(d.citeNodeColor,n):c[d.citeNodeColor][d.backgroundColor](d.highlightFade*a):d.refNodeColor&&t.properties.ROAM_REFS?v?(0,E.p)(d.refNodeColor,n):c[d.refNodeColor][d.backgroundColor](d.highlightFade*a):v?d.nodeHighlight?c[w({id:t.id,cluster:g,coloring:f,linksByNodeId:h,visuals:d})][d.nodeHighlight](a):(0,E.p)(w({id:t.id,cluster:g,coloring:f,linksByNodeId:h,visuals:d}),n):c[w({id:t.id,cluster:g,coloring:f,linksByNodeId:h,visuals:d})][d.backgroundColor](d.highlightFade*a)},O=(e,l)=>{var r,t;return(null===(r=e.source)||void 0===r?void 0:r.id)===(null==l?void 0:l.id)||(null===(t=e.target)||void 0===t?void 0:t.id)===(null==l?void 0:l.id)},D=e=>{let{sourceId:l,targetId:r,linksByNodeId:t,visuals:n,coloring:i,cluster:o}=e;return t[l].length>t[r].length?w({id:l,linksByNodeId:t,visuals:n,cluster:o,coloring:i}):w({id:r,visuals:n,linksByNodeId:t,cluster:o,coloring:i})},H=e=>{let{sourceId:l,targetId:r,needsHighlighting:t,theme:n,visuals:i,highlightColors:o,opacity:d,linksByNodeId:u,coloring:c,cluster:a}=e;if(!i.linkHighlight&&!i.linkColorScheme&&!t){let e=D({sourceId:l,targetId:r,linksByNodeId:u,visuals:i,coloring:c,cluster:a});return(0,E.p)(e,n)}if(!t&&!i.linkColorScheme)return o[D({sourceId:l,targetId:r,linksByNodeId:u,visuals:i,coloring:c,cluster:a})][i.backgroundColor](i.highlightFade*d);if(!t)return o[i.linkColorScheme][i.backgroundColor](i.highlightFade*d);if(!i.linkHighlight&&!i.linkColorScheme){let e=D({sourceId:l,targetId:r,linksByNodeId:u,visuals:i,coloring:c,cluster:a});return(0,E.p)(e,n)}return i.linkHighlight?i.linkColorScheme?o[i.linkColorScheme][i.linkHighlight](d):o[D({sourceId:l,targetId:r,linksByNodeId:u,visuals:i,coloring:c,cluster:a})][i.linkHighlight](d):(0,E.p)(i.linkColorScheme,n)},B=r.e(581).then(r.bind(r,4581));function A(e){let{graphRef:l,physics:r,graphData:c,threeDim:a,linksByNodeId:s,filter:h,emacsNodeId:v,nodeById:b,visuals:S,behavior:R,mouse:w,scope:D,local:A,webSocket:j,tagColors:z,setPreviewNode:T,sidebarHighlightedNode:W,windowWidth:J,windowHeight:Z,openContextMenu:_,contextMenu:G,handleLocal:P,variables:V,clusterRef:X,coloring:Y}=e,{dailyDir:$}=V,[q,K]=(0,u.useState)(null),Q=(0,o.F)(),{emacsTheme:U}=(0,u.useContext)(n.N),ee=(e,l,r)=>{switch(e){case w.preview:T(l);break;case w.local:P(l,R.localSame);break;case w.follow:(0,C.y2)(l,j);break;case w.context:_(l,r)}},el=(0,u.useRef)(null);(0,u.useEffect)(()=>{v&&K(b[v])},[v]);let er=(0,u.useRef)({}),et=(0,u.useRef)({}),en=(0,u.useMemo)(()=>{var e;et.current={};let l=null==c?void 0:null===(e=c.nodes)||void 0===e?void 0:e.filter(e=>{var l,r,t,n;return!(h.dirsBlocklist.length&&h.dirsBlocklist.some(l=>{var r;return null==e?void 0:null===(r=e.file)||void 0===r?void 0:r.includes(l)})||h.dirsAllowlist.length>0&&!h.dirsAllowlist.some(l=>{var r;return null==e?void 0:null===(r=e.file)||void 0===r?void 0:r.includes(l)})||h.tagsBlacklist.length&&h.tagsBlacklist.some(l=>{var r;return(null==e?void 0:null===(r=e.tags)||void 0===r?void 0:r.indexOf(l))>-1})||h.tagsWhitelist.length>0&&!h.tagsWhitelist.some(l=>{var r;return(null==e?void 0:null===(r=e.tags)||void 0===r?void 0:r.indexOf(l))>-1})||h.filelessCites&&(null==e?void 0:null===(l=e.properties)||void 0===l?void 0:l.FILELESS)||(null==h?void 0:h.bad)&&(null==e?void 0:null===(r=e.properties)||void 0===r?void 0:r.bad)||h.dailies&&$&&(null===(t=e.file)||void 0===t?void 0:t.includes($)))&&(!h.noter||null===(n=e.properties)||void 0===n||!n.NOTER_PAGE)||(et.current={...et.current,[e.id]:e},!1)}).filter(e=>{var l;let r=(null!==(l=s[null==e?void 0:e.id])&&void 0!==l?l:[]).filter(e=>!et.current[e.source]&&!et.current[e.target]);return!h.orphans||(h.parent?0!==r.length:0!==r.length&&r.some(e=>!["parent","heading"].includes(e.type)))}),r=l.map(e=>e.id),t=c.links.filter(e=>{let[l,t]=(0,F.J)(e);return!!(r.includes(l)&&r.includes(t))&&(h.parent?"heading"===h.parent?"parent"!==e.type:"heading"!==e.type:!["parent","heading"].includes(e.type))});er.current=t.reduce((e,l)=>{var r,t;let[n,i]=(0,F.J)(l);return{...e,[n]:[...null!==(r=e[n])&&void 0!==r?r:[],l],[i]:[...null!==(t=e[i])&&void 0!==t?t:[],l]}},{});let n=t.map(e=>{let[l,r]=(0,F.J)(e);return{target:l,source:r,weight:"cite"===e.type?1:2}});if("community"===Y.method){let e=p()().nodes(r).edges(n);X.current=e()}return{nodes:l,links:t}},[h,c,Y.method]),[ei,eo]=(0,u.useState)({nodes:[],links:[]});(0,u.useEffect)(()=>{if(!D.nodeIds.length)return;let e=D.nodeIds.length>1?ei.nodes.filter(e=>!D.excludedNodeIds.includes(e.id)):[],l=e.map(e=>e.id),r=L({ids:D.nodeIds,excludedIds:D.excludedNodeIds,n:A.neighbors,linksByNodeId:er.current}),t=en.nodes.filter(t=>{if(e.length){var n;return!l.includes(t.id)&&(null!==(n=er.current[t.id])&&void 0!==n?n:[]).some(e=>{let[l,r]=(0,F.J)(e);return!D.excludedNodeIds.includes(l)&&!D.excludedNodeIds.includes(r)&&(D.nodeIds.includes(l)||D.nodeIds.includes(r))})}return r.includes(t.id)}).map(e=>({...e,x:0,y:0,vy:0,vx:0})),n=[...e,...t],i=n.map(e=>e.id),o=[],d=en.links.filter(e=>{let[r,t]=(0,F.J)(e);return!(o.length&&l.includes(t)&&l.includes(r))&&i.includes(r)&&i.includes(t)}).map(e=>{let[l,r]=(0,F.J)(e);return{source:l,target:r}});eo({nodes:n,links:[...o,...d]})},[A.neighbors,h,D,D.excludedNodeIds,D.nodeIds,c,en.links,en.nodes]),(0,u.useEffect)(()=>{(async()=>{let e=l.current,t=await B;r.gravityOn&&!(D.nodeIds.length&&!r.gravityLocal)?(e.d3Force("x",t.forceX().strength(r.gravity)),e.d3Force("y",t.forceY().strength(r.gravity)),a&&e.d3Force("z",t.forceZ().strength(r.gravity))):(e.d3Force("x",null),e.d3Force("y",null),a&&e.d3Force("z",null)),r.centering?e.d3Force("center",t.forceCenter().strength(r.centeringStrength)):e.d3Force("center",null),r.linkStrength&&e.d3Force("link").strength(r.linkStrength),r.linkIts&&e.d3Force("link").iterations(r.linkIts),r.charge&&e.d3Force("charge").strength(r.charge),e.d3Force("collide",r.collision?t.forceCollide().radius(r.collisionStrength):null)})()},[r,a,D]),(0,u.useEffect)(()=>{var e;null===(e=l.current)||void 0===e||e.d3ReheatSimulation()},[r,D.nodeIds.length]);let ed=(0,u.useRef)(0),[eu,ec]=(0,u.useState)(1),[ea,es]=g(e=>ec(e),S.animationSpeed,m.Al[S.algorithmName]),[eh,eg]=g(e=>ec(Math.min(eu,-1*(e-1))),S.animationSpeed,m.Al[S.algorithmName]),ef=(0,u.useMemo)(()=>{var e;if(!el.current)return{};let l=er.current[el.current.id];return l?Object.fromEntries([null===(e=el.current)||void 0===e?void 0:e.id,...l.flatMap(e=>[e.source,e.target])].map(e=>[e,{}])):{}},[el.current,er.current]);(0,u.useEffect)(()=>{(null==W?void 0:W.id)?K(W):K(null)},[W]);let ev=(0,u.useRef)(null);(0,u.useEffect)(()=>{if(el.current=q,q&&(ev.current=q),!S.highlightAnim)return q?ec(1):ec(0);q?ea():(es(),eu>.5?eh():ec(0))},[q]);let ep=(0,u.useMemo)(()=>Object.fromEntries(m.bG.map(e=>{let l=(0,E.p)(e,Q);return[e,Object.fromEntries(m.bG.map(e=>[e,f.Z(l,(0,E.p)(e,Q))]))]})),[U]),ek=(0,u.useMemo)(()=>{var e,l;let r=null===ev.current||void 0===ev.current?[]:null!==(l=er.current[ev.current.id])&&void 0!==l?l:[];return Object.fromEntries([null===(e=ev.current)||void 0===e?void 0:e.id,...r.flatMap(e=>(0,F.J)(e))].map(e=>[e,{}]))},[JSON.stringify(q),ev.current,er.current]),em=(0,u.useMemo)(()=>(0,E.p)(S.labelTextColor,Q),[S.labelTextColor,U]),eC=(0,u.useMemo)(()=>(0,E.p)(S.labelBackgroundColor,Q),[S.labelBackgroundColor,U]),[eb,ey]=(0,u.useState)(!1),eS=(0,u.useRef)(1),eN={graphData:D.nodeIds.length?ei:en,width:J,height:Z,backgroundColor:(0,E.p)(S.backgroundColor,Q),warmupTicks:1===D.nodeIds.length?100:D.nodeIds.length>1?20:0,onZoom:e=>{let{k:l}=e;return eS.current=l},nodeColor:e=>M({node:e,theme:Q,visuals:S,cluster:X.current,coloring:Y,emacsNodeId:v,highlightColors:ep,highlightedNodes:ef,previouslyHighlightedNodes:ek,linksByNodeId:er.current,opacity:eu,tagColors:z}),nodeRelSize:S.nodeRel,nodeVal:e=>N({node:e,highlightedNodes:ef,linksByNodeId:er.current,opacity:eu,previouslyHighlightedNodes:ek,visuals:S})/Math.pow(eS.current,S.nodeZoomSize),nodeCanvasObject:(e,l,r)=>{!function(e){var l,r,t,n;let{labelBackgroundColor:i,labelTextColor:o,node:d,ctx:u,globalScale:c,highlightedNodes:a,previouslyHighlightedNodes:s,visuals:h,opacity:g,filteredLinksByNodeId:f,hoverNode:v,lastHoverNode:p}=e;if(!d||!h.labels)return;let k=null!==(l=null==v?void 0:v.id)&&void 0!==l?l:"",m=null!==(r=null==p?void 0:p.id)&&void 0!==r?r:"",C=null!==(t=f[d.id])&&void 0!==t?t:[],b=!!(a[d.id]||s[d.id]),S=Math.min(5*(c-h.labelScale)+2*Math.pow(Math.min(C.length,h.labelDynamicDegree),h.labelDynamicStrength),1);if(S<.01&&!b)return;let F=null!==(n=d.title)&&void 0!==n?n:"",L=F.substring(0,h.labelLength),E=Math.cbrt(h.nodeRel*N({node:d,highlightedNodes:a,linksByNodeId:f,opacity:g,previouslyHighlightedNodes:s,visuals:h})/Math.pow(c,h.nodeZoomSize)),R=h.labelFontSize/Math.cbrt(Math.pow(c,h.nodeZoomSize)),w=[1.1*u.measureText(L).width,R].map(e=>e+.5*R),M=I(S,h,c,g,b);if(h.labelBackgroundColor&&h.labelBackgroundOpacity){let e=x(i,M*h.labelBackgroundOpacity);u.fillStyle=e,u.fillRect(d.x-w[0]/2,d.y-w[1]/2+E,...w)}u.textAlign="center",u.textBaseline="middle";let O=x(o,M);u.fillStyle=O,u.font="".concat(R,"px Sans-Serif");let D=y()(L,{width:h.labelWordWrap}).split("\n"),H=F.length>h.labelLength?[...D.slice(0,-1),"".concat(D.slice(-1),"...")]:D,B=[k,m].includes(d.id)?1+.3*g:1;H.forEach((e,l)=>{u.fillText(e,d.x,d.y+B*E*8+h.labelLineSpace*R*l)})}({nodeRel:S.nodeRel,filteredLinksByNodeId:er.current,lastHoverNode:ev.current,node:e,ctx:l,globalScale:r,highlightedNodes:ef,previouslyHighlightedNodes:ek,visuals:S,opacity:eu,labelTextColor:em,labelBackgroundColor:eC,hoverNode:q})},nodeCanvasObjectMode:()=>"after",linkDirectionalParticles:S.particles?S.particlesNumber:void 0,linkDirectionalArrowLength:S.arrows?S.arrowsLength:void 0,linkDirectionalArrowRelPos:S.arrowsPos,linkDirectionalArrowColor:S.arrowsColor?()=>(0,E.p)(S.arrowsColor,Q):void 0,linkColor:e=>{var l;let r="object"==typeof e.source?e.source.id:e.source,t="object"==typeof e.target?e.target.id:e.target,n=O(e,el.current),i=O(e,ev.current),o=n||i;return S.refLinkColor&&"ref"===e.type?o&&(S.refLinkHighlightColor||S.linkHighlight)?ep[S.refLinkColor][S.refLinkHighlightColor||S.linkHighlight](eu):ep[S.refLinkColor][S.backgroundColor](S.highlightFade*eu):S.citeLinkColor&&(null===(l=e.type)||void 0===l?void 0:l.includes("cite"))?o&&(S.citeLinkHighlightColor||S.linkHighlight)?ep[S.citeLinkColor][S.citeLinkHighlightColor||S.linkHighlight](eu):ep[S.citeLinkColor][S.backgroundColor](S.highlightFade*eu):H({sourceId:r,targetId:t,needsHighlighting:o,theme:Q,cluster:X.current,coloring:Y,highlightColors:ep,linksByNodeId:er.current,opacity:eu,visuals:S})},linkWidth:e=>{if(1===S.highlightLinkSize)return S.linkWidth;let l=O(e,el.current),r=O(e,ev.current);return l||r?S.linkWidth*(1+eu*(S.highlightLinkSize-1)):S.linkWidth},linkDirectionalParticleWidth:S.particlesWidth,d3AlphaDecay:r.alphaDecay,d3AlphaMin:r.alphaMin,d3VelocityDecay:r.velocityDecay,onNodeClick:(e,l)=>{let r=l.timeStamp-ed.current<200;if(ed.current=l.timeStamp,r)return ee("double",e,l);let t=ed.current;return setTimeout(()=>{if(ed.current===t)return ee("click",e,l)},200)},onNodeHover:e=>{S.highlight&&!eb&&(q||(eg(),ec(0)),K(e))},onNodeRightClick:(e,l)=>{ee("right",e,l)},onNodeDrag:e=>{K(e),ey(!0)},onNodeDragEnd:()=>{K(null),ey(!1)}};return(0,t.jsx)(d.x,{overflow:"hidden",onClick:G.onClose,children:a?(0,t.jsx)(i.s6,{ref:l,...eN,nodeThreeObjectExtend:!0,nodeOpacity:S.nodeOpacity,nodeResolution:S.nodeResolution,linkOpacity:S.linkOpacity,nodeThreeObject:e=>{if(!S.labels||S.labels<3&&!ef[e.id])return;let l=new k.Z(e.title.substring(0,40));return l.color=(0,E.p)(S.labelTextColor,Q),l.backgroundColor=(0,E.p)(S.labelBackgroundColor,Q),l.padding=2,l.textHeight=8,l}}):(0,t.jsx)(i.f$,{ref:l,...eN,linkLineDash:e=>{var l;return S.citeDashes&&(null===(l=e.type)||void 0===l?void 0:l.includes("cite"))?[S.citeDashLength,S.citeGapLength]:S.refDashes&&"ref"==e.type?[S.refDashLength,S.refGapLength]:null}})})}}}]);