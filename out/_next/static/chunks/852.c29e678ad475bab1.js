"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[852],{2852:function(e,l,r){r.r(l),r.d(l,{default:function(){return B}});var t=r(5893),n=r(6645),i=r(8460),o=r(7984),d=r(8029),u=r(7294),c=r(4087),a=r.n(c);function s(e){let l=(0,u.useRef)(e);return l.current=e,l}function h(e){let l=(0,u.useRef)(null),r=s(e);return l.current||(l.current=function(){for(var e=arguments.length,l=Array(e),t=0;t<e;t++)l[t]=arguments[t];return r.current.apply(this,l)}),l.current}function g(e,l,r){let t=(0,u.useRef)(0),n=(0,u.useRef)(0),i=s(e),o=h(e=>{n.current||(n.current=e);let d=e-n.current,u=l>0?d/l:1;u<0&&(u=0),u>1&&(u=1),u<1&&(t.current=a()(o)),r?i.current(r(u)):i.current(u)}),d=(0,u.useCallback)(()=>{t.current&&(a().cancel(t.current),t.current=0),n.current=0},[]),c=h(()=>{d(),t.current=a()(o)});return!function(e){let l=(0,u.useRef)(e);l.current=e,(0,u.useEffect)(()=>()=>{l.current()},[])}(d),[c,d]}var f=r(6377),v=r(2802),p=r.n(v),k=r(8256),m=r(7173),C=r(2663),b=r.n(C),S=r(2101);let y=e=>{var l;let{linksByNodeId:r,visuals:t,highlightedNodes:n,previouslyHighlightedNodes:i,opacity:o,node:d}=e,u=null!==(l=r[d.id])&&void 0!==l?l:[],c=u.length?u.filter(e=>"parent"===e.type).length:0,a=3+u.length*t.nodeSizeLinks-(S.h.parent?0:c);return 1===t.highlightNodeSize?a:a*(n[d.id]||i[d.id]?1+o*(t.highlightNodeSize-1):1)};function N(e,l){return"rgba("+(e=e.replace("#","")).match(RegExp("(.{"+e.length/3+"})","g")).map(l=>parseInt(e.length%2?l+l:l,16)).concat(isFinite(l)?l:1).join(",")+")"}let I=(e,l,r,t,n)=>n?Math.max(e,t):1*e*(-1*(l.highlightFade*t-1));var x=r(4452);let L=e=>{let{ids:l,excludedIds:r,n:t,linksByNodeId:n}=e,i=[l[0]],o=[],d=[l[0]];return Array.from({length:t},()=>{i.forEach(e=>{var l;(null!==(l=n[e])&&void 0!==l?l:[]).forEach(e=>{let[l,t]=(0,x.J)(e);if(!r.some(e=>[l,t].includes(e))){if(!d.includes(l)){o.push(l);return}d.includes(t)||o.push(t)}})}),i=o,o.forEach(e=>e&&d.push(e)),o=[]}),d};var E=r(8920);let F=(e,l,r)=>Math.min(Math.max(e,l),r),w=e=>{var l,r;let{id:t,linksByNodeId:n,visuals:i,coloring:o,cluster:d}=e,u=null!==(r=null===(l=n[t])||void 0===l?void 0:l.length)&&void 0!==r?r:0;return"degree"===o.method?i.nodeColorScheme[F(u,0,i.nodeColorScheme.length-1)]:i.nodeColorScheme[u&&d[t]%i.nodeColorScheme.length]},R=e=>{var l,r;let{node:t,theme:n,highlightedNodes:i,previouslyHighlightedNodes:o,visuals:d,tagColors:u,highlightColors:c,opacity:a,emacsNodeId:s,linksByNodeId:h,cluster:g,coloring:f}=e,v=i[t.id]||o[t.id];if(d.emacsNodeColor&&t.id===s)return(0,E.p)(d.emacsNodeColor,n);if(u&&(null==t?void 0:t.tags.some(e=>u[e]))){let e=u[null==t?void 0:t.tags.filter(e=>u[e])[0]];return v?c[e][e](d.highlightFade*a):c[e][d.backgroundColor](d.highlightFade*a)}return d.citeNodeColor&&(null==t?void 0:null===(l=t.properties)||void 0===l?void 0:l.ROAM_REFS)&&(null==t?void 0:null===(r=t.properties)||void 0===r?void 0:r.FILELESS)?v?(0,E.p)(d.citeNodeColor,n):c[d.citeNodeColor][d.backgroundColor](d.highlightFade*a):d.refNodeColor&&t.properties.ROAM_REFS?v?(0,E.p)(d.refNodeColor,n):c[d.refNodeColor][d.backgroundColor](d.highlightFade*a):v?d.nodeHighlight?c[w({id:t.id,cluster:g,coloring:f,linksByNodeId:h,visuals:d})][d.nodeHighlight](a):(0,E.p)(w({id:t.id,cluster:g,coloring:f,linksByNodeId:h,visuals:d}),n):c[w({id:t.id,cluster:g,coloring:f,linksByNodeId:h,visuals:d})][d.backgroundColor](d.highlightFade*a)},M=(e,l)=>{var r,t;return(null===(r=e.source)||void 0===r?void 0:r.id)===(null==l?void 0:l.id)||(null===(t=e.target)||void 0===t?void 0:t.id)===(null==l?void 0:l.id)},D=e=>{let{sourceId:l,targetId:r,linksByNodeId:t,visuals:n,coloring:i,cluster:o}=e;return t[l].length>t[r].length?w({id:l,linksByNodeId:t,visuals:n,cluster:o,coloring:i}):w({id:r,visuals:n,linksByNodeId:t,cluster:o,coloring:i})},H=e=>{let{sourceId:l,targetId:r,needsHighlighting:t,theme:n,visuals:i,highlightColors:o,opacity:d,linksByNodeId:u,coloring:c,cluster:a}=e;if(!i.linkHighlight&&!i.linkColorScheme&&!t){let e=D({sourceId:l,targetId:r,linksByNodeId:u,visuals:i,coloring:c,cluster:a});return(0,E.p)(e,n)}if(!t&&!i.linkColorScheme)return o[D({sourceId:l,targetId:r,linksByNodeId:u,visuals:i,coloring:c,cluster:a})][i.backgroundColor](i.highlightFade*d);if(!t)return o[i.linkColorScheme][i.backgroundColor](i.highlightFade*d);if(!i.linkHighlight&&!i.linkColorScheme){let e=D({sourceId:l,targetId:r,linksByNodeId:u,visuals:i,coloring:c,cluster:a});return(0,E.p)(e,n)}return i.linkHighlight?i.linkColorScheme?o[i.linkColorScheme][i.linkHighlight](d):o[D({sourceId:l,targetId:r,linksByNodeId:u,visuals:i,coloring:c,cluster:a})][i.linkHighlight](d):(0,E.p)(i.linkColorScheme,n)},A=r.e(581).then(r.bind(r,4581));function B(e){let{graphRef:l,physics:r,graphData:c,linksByNodeId:a,filter:s,emacsNodeId:h,nodeById:v,visuals:C,behavior:S,mouse:F,scope:w,local:D,webSocket:B,tagColors:O,setPreviewNode:j,sidebarHighlightedNode:z,windowWidth:W,windowHeight:J,openContextMenu:T,contextMenu:_,handleLocal:G,variables:P,clusterRef:Z,coloring:V}=e,{dailyDir:X}=P,[Y,$]=(0,u.useState)(null),q=(0,o.F)(),{emacsTheme:K}=(0,u.useContext)(n.Ni),Q=(e,l,r)=>{switch(e){case F.preview:j(l);break;case F.local:G(l,S.localSame);break;case F.follow:(0,m.y2)(l,B);break;case F.context:T(l,r)}},U=(0,u.useRef)(null);(0,u.useEffect)(()=>{h&&$(v[h])},[h]);let ee=(0,u.useRef)({}),el=(0,u.useRef)({}),er=(0,u.useMemo)(()=>{var e;el.current={};let l=null==c?void 0:null===(e=c.nodes)||void 0===e?void 0:e.filter(e=>{var l,r,t,n;return!(s.dirsBlocklist.length&&s.dirsBlocklist.some(l=>{var r;return null==e?void 0:null===(r=e.file)||void 0===r?void 0:r.includes(l)})||s.dirsAllowlist.length>0&&!s.dirsAllowlist.some(l=>{var r;return null==e?void 0:null===(r=e.file)||void 0===r?void 0:r.includes(l)})||s.tagsBlacklist.length&&s.tagsBlacklist.some(l=>{var r;return(null==e?void 0:null===(r=e.tags)||void 0===r?void 0:r.indexOf(l))>-1})||s.tagsWhitelist.length>0&&!s.tagsWhitelist.some(l=>{var r;return(null==e?void 0:null===(r=e.tags)||void 0===r?void 0:r.indexOf(l))>-1})||s.filelessCites&&(null==e?void 0:null===(l=e.properties)||void 0===l?void 0:l.FILELESS)||(null==s?void 0:s.bad)&&(null==e?void 0:null===(r=e.properties)||void 0===r?void 0:r.bad)||s.dailies&&X&&(null===(t=e.file)||void 0===t?void 0:t.includes(X)))&&(!s.noter||null===(n=e.properties)||void 0===n||!n.NOTER_PAGE)||(el.current={...el.current,[e.id]:e},!1)}).filter(e=>{var l;let r=(null!==(l=a[null==e?void 0:e.id])&&void 0!==l?l:[]).filter(e=>!el.current[e.source]&&!el.current[e.target]);return!s.orphans||(s.parent?0!==r.length:0!==r.length&&r.some(e=>!["parent","heading"].includes(e.type)))}),r=l.map(e=>e.id),t=c.links.filter(e=>{let[l,t]=(0,x.J)(e);return!!(r.includes(l)&&r.includes(t))&&(s.parent?"heading"===s.parent?"parent"!==e.type:"heading"!==e.type:!["parent","heading"].includes(e.type))});ee.current=t.reduce((e,l)=>{var r,t;let[n,i]=(0,x.J)(l);return{...e,[n]:[...null!==(r=e[n])&&void 0!==r?r:[],l],[i]:[...null!==(t=e[i])&&void 0!==t?t:[],l]}},{});let n=t.map(e=>{let[l,r]=(0,x.J)(e);return{target:l,source:r,weight:"cite"===e.type?1:2}});if("community"===V.method){let e=p()().nodes(r).edges(n);Z.current=e()}return{nodes:l,links:t}},[s,c,V.method]),[et,en]=(0,u.useState)({nodes:[],links:[]});(0,u.useEffect)(()=>{if(!w.nodeIds.length)return;let e=w.nodeIds.length>1?et.nodes.filter(e=>!w.excludedNodeIds.includes(e.id)):[],l=e.map(e=>e.id),r=L({ids:w.nodeIds,excludedIds:w.excludedNodeIds,n:D.neighbors,linksByNodeId:ee.current}),t=er.nodes.filter(t=>{if(e.length){var n;return!l.includes(t.id)&&(null!==(n=ee.current[t.id])&&void 0!==n?n:[]).some(e=>{let[l,r]=(0,x.J)(e);return!w.excludedNodeIds.includes(l)&&!w.excludedNodeIds.includes(r)&&(w.nodeIds.includes(l)||w.nodeIds.includes(r))})}return r.includes(t.id)}).map(e=>({...e,x:0,y:0,vy:0,vx:0})),n=[...e,...t],i=n.map(e=>e.id),o=[],d=er.links.filter(e=>{let[r,t]=(0,x.J)(e);return!(o.length&&l.includes(t)&&l.includes(r))&&i.includes(r)&&i.includes(t)}).map(e=>{let[l,r]=(0,x.J)(e);return{source:l,target:r}});en({nodes:n,links:[...o,...d]})},[D.neighbors,s,w,w.excludedNodeIds,w.nodeIds,c,er.links,er.nodes]),(0,u.useEffect)(()=>{(async()=>{let e=l.current,t=await A;r.gravityOn&&!(w.nodeIds.length&&!r.gravityLocal)?(e.d3Force("x",t.forceX().strength(r.gravity)),e.d3Force("y",t.forceY().strength(r.gravity))):(e.d3Force("x",null),e.d3Force("y",null)),r.centering?e.d3Force("center",t.forceCenter().strength(r.centeringStrength)):e.d3Force("center",null),r.linkStrength&&e.d3Force("link").strength(r.linkStrength),r.linkIts&&e.d3Force("link").iterations(r.linkIts),r.charge&&e.d3Force("charge").strength(r.charge),e.d3Force("collide",r.collision?t.forceCollide().radius(r.collisionStrength):null)})()},[r,w]),(0,u.useEffect)(()=>{var e;null===(e=l.current)||void 0===e||e.d3ReheatSimulation()},[r,w.nodeIds.length]);let ei=(0,u.useRef)(0),[eo,ed]=(0,u.useState)(1),[eu,ec]=g(e=>ed(e),C.animationSpeed,k.Al[C.algorithmName]),[ea,es]=g(e=>ed(Math.min(eo,-1*(e-1))),C.animationSpeed,k.Al[C.algorithmName]),eh=(0,u.useMemo)(()=>{var e;if(!U.current)return{};let l=ee.current[U.current.id];return l?Object.fromEntries([null===(e=U.current)||void 0===e?void 0:e.id,...l.flatMap(e=>[e.source,e.target])].map(e=>[e,{}])):{}},[U.current,ee.current]);(0,u.useEffect)(()=>{(null==z?void 0:z.id)?$(z):$(null)},[z]);let eg=(0,u.useRef)(null);(0,u.useEffect)(()=>{if(U.current=Y,Y&&(eg.current=Y),!C.highlightAnim)return Y?ed(1):ed(0);Y?eu():(ec(),eo>.5?ea():ed(0))},[Y]);let ef=(0,u.useMemo)(()=>Object.fromEntries(k.bG.map(e=>{let l=(0,E.p)(e,q);return[e,Object.fromEntries(k.bG.map(e=>[e,f.Z(l,(0,E.p)(e,q))]))]})),[K]),ev=(0,u.useMemo)(()=>{var e,l;let r=null===eg.current||void 0===eg.current?[]:null!==(l=ee.current[eg.current.id])&&void 0!==l?l:[];return Object.fromEntries([null===(e=eg.current)||void 0===e?void 0:e.id,...r.flatMap(e=>(0,x.J)(e))].map(e=>[e,{}]))},[JSON.stringify(Y),eg.current,ee.current]),ep=(0,u.useMemo)(()=>(0,E.p)(C.labelTextColor,q),[C.labelTextColor,K]),ek=(0,u.useMemo)(()=>(0,E.p)(C.labelBackgroundColor,q),[C.labelBackgroundColor,K]),[em,eC]=(0,u.useState)(!1),eb=(0,u.useRef)(1),eS={graphData:w.nodeIds.length?et:er,width:W,height:J,backgroundColor:(0,E.p)(C.backgroundColor,q),warmupTicks:1===w.nodeIds.length?100:w.nodeIds.length>1?20:0,onZoom:e=>{let{k:l}=e;return eb.current=l},nodeColor:e=>R({node:e,theme:q,visuals:C,cluster:Z.current,coloring:V,emacsNodeId:h,highlightColors:ef,highlightedNodes:eh,previouslyHighlightedNodes:ev,linksByNodeId:ee.current,opacity:eo,tagColors:O}),nodeRelSize:C.nodeRel,nodeVal:e=>y({node:e,highlightedNodes:eh,linksByNodeId:ee.current,opacity:eo,previouslyHighlightedNodes:ev,visuals:C})/Math.pow(eb.current,C.nodeZoomSize),nodeCanvasObject:(e,l,r)=>{!function(e){var l,r,t,n;let{labelBackgroundColor:i,labelTextColor:o,node:d,ctx:u,globalScale:c,highlightedNodes:a,previouslyHighlightedNodes:s,visuals:h,opacity:g,filteredLinksByNodeId:f,hoverNode:v,lastHoverNode:p}=e;if(!d||!h.labels)return;let k=null!==(l=null==v?void 0:v.id)&&void 0!==l?l:"",m=null!==(r=null==p?void 0:p.id)&&void 0!==r?r:"",C=null!==(t=f[d.id])&&void 0!==t?t:[],S=!!(a[d.id]||s[d.id]),x=Math.min(5*(c-h.labelScale)+2*Math.pow(Math.min(C.length,h.labelDynamicDegree),h.labelDynamicStrength),1);if(x<.01&&!S)return;let L=null!==(n=d.title)&&void 0!==n?n:"",E=L.substring(0,h.labelLength),F=Math.cbrt(h.nodeRel*y({node:d,highlightedNodes:a,linksByNodeId:f,opacity:g,previouslyHighlightedNodes:s,visuals:h})/Math.pow(c,h.nodeZoomSize)),w=h.labelFontSize/Math.cbrt(Math.pow(c,h.nodeZoomSize)),R=[1.1*u.measureText(E).width,w].map(e=>e+.5*w),M=I(x,h,c,g,S);if(h.labelBackgroundColor&&h.labelBackgroundOpacity){let e=N(i,M*h.labelBackgroundOpacity);u.fillStyle=e,u.fillRect(d.x-R[0]/2,d.y-R[1]/2+F,...R)}u.textAlign="center",u.textBaseline="middle";let D=N(o,M);u.fillStyle=D,u.font="".concat(w,"px Sans-Serif");let H=b()(E,{width:h.labelWordWrap}).split("\n"),A=L.length>h.labelLength?[...H.slice(0,-1),"".concat(H.slice(-1),"...")]:H,B=[k,m].includes(d.id)?1+.3*g:1;A.forEach((e,l)=>{u.fillText(e,d.x,d.y+B*F*8+h.labelLineSpace*w*l)})}({nodeRel:C.nodeRel,filteredLinksByNodeId:ee.current,lastHoverNode:eg.current,node:e,ctx:l,globalScale:r,highlightedNodes:eh,previouslyHighlightedNodes:ev,visuals:C,opacity:eo,labelTextColor:ep,labelBackgroundColor:ek,hoverNode:Y})},nodeCanvasObjectMode:()=>"after",linkDirectionalParticles:C.particles?C.particlesNumber:void 0,linkDirectionalArrowLength:C.arrows?C.arrowsLength:void 0,linkDirectionalArrowRelPos:C.arrowsPos,linkDirectionalArrowColor:C.arrowsColor?()=>(0,E.p)(C.arrowsColor,q):void 0,linkColor:e=>{var l;let r="object"==typeof e.source?e.source.id:e.source,t="object"==typeof e.target?e.target.id:e.target,n=M(e,U.current),i=M(e,eg.current),o=n||i;return C.refLinkColor&&"ref"===e.type?o&&(C.refLinkHighlightColor||C.linkHighlight)?ef[C.refLinkColor][C.refLinkHighlightColor||C.linkHighlight](eo):ef[C.refLinkColor][C.backgroundColor](C.highlightFade*eo):C.citeLinkColor&&(null===(l=e.type)||void 0===l?void 0:l.includes("cite"))?o&&(C.citeLinkHighlightColor||C.linkHighlight)?ef[C.citeLinkColor][C.citeLinkHighlightColor||C.linkHighlight](eo):ef[C.citeLinkColor][C.backgroundColor](C.highlightFade*eo):H({sourceId:r,targetId:t,needsHighlighting:o,theme:q,cluster:Z.current,coloring:V,highlightColors:ef,linksByNodeId:ee.current,opacity:eo,visuals:C})},linkWidth:e=>{if(1===C.highlightLinkSize)return C.linkWidth;let l=M(e,U.current),r=M(e,eg.current);return l||r?C.linkWidth*(1+eo*(C.highlightLinkSize-1)):C.linkWidth},linkDirectionalParticleWidth:C.particlesWidth,d3AlphaDecay:r.alphaDecay,d3AlphaMin:r.alphaMin,d3VelocityDecay:r.velocityDecay,onNodeClick:(e,l)=>{let r=l.timeStamp-ei.current<200;if(ei.current=l.timeStamp,r)return Q("double",e,l);let t=ei.current;return setTimeout(()=>{if(ei.current===t)return Q("click",e,l)},200)},onNodeHover:e=>{C.highlight&&!em&&(Y||(es(),ed(0)),$(e))},onNodeRightClick:(e,l)=>{Q("right",e,l)},onNodeDrag:e=>{$(e),eC(!0)},onNodeDragEnd:()=>{$(null),eC(!1)}};return(0,t.jsx)(d.x,{overflow:"hidden",onClick:_.onClose,children:(0,t.jsx)(i.f$,{ref:l,...eS,linkLineDash:e=>{var l;return C.citeDashes&&(null===(l=e.type)||void 0===l?void 0:l.includes("cite"))?[C.citeDashLength,C.citeGapLength]:C.refDashes&&"ref"==e.type?[C.refDashLength,C.refGapLength]:null}})})}}}]);